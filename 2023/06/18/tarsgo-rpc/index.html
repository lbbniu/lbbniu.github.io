<!doctype html><html lang=zh dir=ltr><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>å†™ç»™Goå¼€å‘è€…çš„Tarsæ•™ç¨‹-é€šä¿¡æ¨¡å¼ | lbbniu</title>
<meta name=generator content="Hugo Eureka 0.9.3"><link rel=stylesheet href=/css/eureka.min.9cec6350e37e534b0338fa9a085bf06855de3b0f2dcf857e792e5e97b07ea905d4d5513db554cbc26a9c3da622bae92d.css><script defer src=/js/eureka.min.fa9a6bf6d7a50bb635b4cca7d2ba5cf3dfb095ae3798773f1328f7950028b48c17d06276594e1b5f244a25a6c969a705.js></script><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload href="https://fonts.googleapis.com/css2?family=Lora:wght@400;600;700&amp;family=Noto+Serif+SC:wght@400;600;700&amp;display=swap" as=style onload='this.onload=null,this.rel="stylesheet"'><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/styles/github.min.css media=print onload='this.media="all",this.onload=null' crossorigin><script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/highlight.min.js crossorigin></script><script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/dart.min.js crossorigin></script><script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/php.min.js crossorigin></script><script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/java.min.js crossorigin></script><script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/go.min.js crossorigin></script><script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/python.min.js crossorigin></script><link rel=stylesheet href=/css/highlightjs.min.2958991528e43eb6fc9b8c4f2b8e052f79c4010718e1d1e888a777620e9ee63021c2c57ec7417a3108019bb8c41943e6.css media=print onload='this.media="all",this.onload=null'><script defer type=text/javascript src=/js/fontawesome.min.35973bea57658ef0dd22ad59ea4642b6c8c67af62bed8659ac326d284ef285a6657cdbcf57d3b2910e7e992f2b20426e.js></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css integrity=sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ media=print onload='this.media="all",this.onload=null' crossorigin><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js integrity=sha384-VQ8d8WVFw0yHhCk5E8I86oOhv48xLpnDZx5T9GogA/Y84DcCKWXDmSDfn13bzFZY crossorigin></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]})})</script><script defer src=https://cdn.jsdelivr.net/npm/mermaid@8.14.0/dist/mermaid.min.js integrity=sha384-atOyb0FxAgN9LyAc6PEf9BjgwLISyansgdH8/VXQH8p2o5vfrRgmGIJ2Sg22L0A0 crossorigin></script><link rel=icon type=image/png sizes=32x32 href=/images/icon_hu46eef4dc61dcf438cf488ad55e1d2c12_638750_32x32_fill_box_center_3.png><link rel=apple-touch-icon sizes=180x180 href=/images/icon_hu46eef4dc61dcf438cf488ad55e1d2c12_638750_180x180_fill_box_center_3.png><meta name=description content="å†™ç»™Goå¼€å‘è€…çš„Tarsæ•™ç¨‹-é€šä¿¡æ¨¡å¼"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"æ–‡ç« åˆ—è¡¨","item":"/post/"},{"@type":"ListItem","position":2,"name":"å†™ç»™Goå¼€å‘è€…çš„Tarsæ•™ç¨‹-é€šä¿¡æ¨¡å¼","item":"/2023/06/18/tarsgo-rpc/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"/2023/06/18/tarsgo-rpc/"},"headline":"å†™ç»™Goå¼€å‘è€…çš„Tarsæ•™ç¨‹-é€šä¿¡æ¨¡å¼ | lbbniu","datePublished":"2023-06-18T15:20:00+08:00","dateModified":"2023-06-18T15:20:00+08:00","wordCount":1015,"author":{"@type":"Person","name":["lbbniu"]},"publisher":{"@type":"Person","name":"lbbniu","logo":{"@type":"ImageObject","url":"/images/icon.gif"}},"description":"å†™ç»™Goå¼€å‘è€…çš„Tarsæ•™ç¨‹-é€šä¿¡æ¨¡å¼"}</script><meta property="og:title" content="å†™ç»™Goå¼€å‘è€…çš„Tarsæ•™ç¨‹-é€šä¿¡æ¨¡å¼ | lbbniu"><meta property="og:type" content="article"><meta property="og:image" content="/images/icon.png"><meta property="og:url" content="/2023/06/18/tarsgo-rpc/"><meta property="og:description" content="å†™ç»™Goå¼€å‘è€…çš„Tarsæ•™ç¨‹-é€šä¿¡æ¨¡å¼"><meta property="og:locale" content="zh"><meta property="og:site_name" content="lbbniu"><meta property="article:published_time" content="2023-06-18T15:20:00+08:00"><meta property="article:modified_time" content="2023-06-18T15:20:00+08:00"><meta property="article:section" content="post"><meta property="article:tag" content="Tars"><meta property="og:see_also" content="/2023/06/18/tarsgo-protocol/"><meta property="og:see_also" content="/cloud-native/tars%E5%AE%B9%E5%99%A8%E5%8C%96/"><body class="flex min-h-screen flex-col"><header class="min-h-16 pl-scrollbar bg-secondary-bg fixed z-50 flex w-full items-center shadow-sm"><div class="mx-auto w-full max-w-screen-xl"><script>let storageColorScheme=localStorage.getItem("lightDarkMode");((storageColorScheme=="Auto"||storageColorScheme==null)&&window.matchMedia("(prefers-color-scheme: dark)").matches||storageColorScheme=="Dark")&&document.getElementsByTagName("html")[0].classList.add("dark")</script><nav class="flex items-center justify-between flex-wrap px-4 py-4 md:py-0"><a href=/ class="me-6 text-primary-text text-xl font-bold">lbbniu</a>
<button id=navbar-btn class="md:hidden flex items-center px-3 py-2" aria-label="Open Navbar">
<i class="fas fa-bars"></i></button><div id=target class="hidden block md:flex md:grow md:justify-between md:items-center w-full md:w-auto text-primary-text z-20"><div class="md:flex md:h-16 text-sm md:grow pb-4 md:pb-0 border-b md:border-b-0"><a href=/post/ class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2 border-transparent me-4">æ–‡ç« </a>
<a href=/cloud-native/ class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2 border-transparent me-4">äº‘åŸç”Ÿ</a>
<a href=/study/ class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2 border-transparent me-4">ç®—æ³•å­¦ä¹ </a>
<a href=/docs/ class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2 border-transparent me-4">Goå­¦ä¹ è®­ç»ƒè¥</a>
<a href=/tags/ class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2 border-transparent me-4">æ ‡ç­¾</a></div><div class=flex><div class="relative pt-4 md:pt-0"><div class="cursor-pointer hover:text-eureka" id=lightDarkMode><i class="fas fa-adjust"></i></div><div class="fixed hidden inset-0 opacity-0 h-full w-full cursor-default z-30" id=is-open></div><div class="absolute flex flex-col start-0 md:start-auto end-auto md:end-0 hidden bg-secondary-bg w-48 rounded py-2 border border-tertiary-bg cursor-pointer z-40" id=lightDarkOptions><span class="px-4 py-1 hover:text-eureka" name=Light>æµ…è‰²</span>
<span class="px-4 py-1 hover:text-eureka" name=Dark>æ·±è‰²</span>
<span class="px-4 py-1 hover:text-eureka" name=Auto>è‡ªåŠ¨</span></div></div></div></div><div class="fixed hidden inset-0 opacity-0 h-full w-full cursor-default z-0" id=is-open-mobile></div></nav><script>let element=document.getElementById("lightDarkMode");storageColorScheme==null||storageColorScheme=="Auto"?document.addEventListener("DOMContentLoaded",()=>{window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",switchDarkMode)}):storageColorScheme=="Light"?(element.firstElementChild.classList.remove("fa-adjust"),element.firstElementChild.setAttribute("data-icon","sun"),element.firstElementChild.classList.add("fa-sun")):storageColorScheme=="Dark"&&(element.firstElementChild.classList.remove("fa-adjust"),element.firstElementChild.setAttribute("data-icon","moon"),element.firstElementChild.classList.add("fa-moon")),document.addEventListener("DOMContentLoaded",()=>{getcolorscheme(),switchBurger()})</script></div></header><main class="grow pt-16"><div class=pl-scrollbar><div class="mx-auto w-full max-w-screen-xl lg:px-4 xl:px-8"><div class="grid grid-cols-2 gap-4 lg:grid-cols-8 lg:pt-12"><div class="bg-secondary-bg col-span-2 rounded px-6 py-8 lg:col-span-6"><article class=prose><h1 class=mb-4>å†™ç»™Goå¼€å‘è€…çš„Tarsæ•™ç¨‹-é€šä¿¡æ¨¡å¼</h1><div class="text-tertiary-text not-prose mt-2 flex flex-row flex-wrap items-center"><div class="me-6 my-2"><i class="fas fa-calendar me-1"></i>
<span>2023-06-18</span></div><div class="me-6 my-2"><i class="fas fa-clock me-1"></i>
<span>5åˆ†é’Ÿé˜…è¯»æ—¶é•¿</span></div><div class="me-6 my-2"><i class="fas fa-folder me-1"></i>
<a href=/categories/tarsgo/ class=hover:text-eureka>tarsgo</a></div></div><p>æœ¬ç¯‡ä¸ºã€å†™ç»™Goå¼€å‘è€…çš„Tarsæ•™ç¨‹ç³»åˆ—ã€‘ç¬¬äºŒç¯‡</p><ul><li>ç¬¬ä¸€ç¯‡ï¼š<a href=./%e5%86%99%e7%bb%99go%e5%bc%80%e5%8f%91%e8%80%85%e7%9a%84Tars%e6%95%99%e7%a8%8b-tars%e5%9f%ba%e7%a1%80.md>Tarsåè®®åŸºç¡€</a></li><li>ç¬¬äºŒç¯‡ï¼šé€šä¿¡æ¨¡å¼</li></ul><hr><p>ä¸Šä¸€ç¯‡ä»‹ç»äº†å¦‚ä½•ç¼–å†™ Tars çš„ idlï¼Œå¹¶ä½¿ç”¨ idl ç”Ÿæˆäº† TarsGo RPC çš„ä»£ç ï¼Œç°åœ¨æ¥çœ‹çœ‹å¦‚ä½•ç¼–å†™å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„ä»£ç </p><h2 id=tars-ç¤ºä¾‹-idl>Tars ç¤ºä¾‹ IDL</h2><pre><code class=language-apl>module order {
    struct Order {
        1 require string id;
        2 optional vector&lt;string&gt; items;
        3 optional string description;
        4 require float price;
        5 optional string destination;
    };
    
    interface OrderManagement {
        Order getOrder(string orderId);
    };
};
</code></pre><h3 id=ç”Ÿæˆ-go-åè®®ç¼–è§£ç ä»£ç >ç”Ÿæˆ go åè®®ç¼–è§£ç ä»£ç </h3><pre><code class=language-bash>tars2go -outdir=. \
	-module=github.com/lbbniu/TarsGo-tutorial \
	proto/order.tars
</code></pre><pre><code class=language-bash>order
â”œâ”€â”€ order.go
â””â”€â”€ OrderManagement.tars.go
proto
â””â”€â”€ order.tars
</code></pre><h2 id=server-å®ç°>server å®ç°</h2><h3 id=æœåŠ¡ç«¯å¼€å‘>æœåŠ¡ç«¯å¼€å‘</h3><p>1ã€ç”± Tars æ–‡ä»¶ç”Ÿæˆçš„ Go ä»£ç ä¸­åŒ…å«äº† interface çš„æ¥å£å®šä¹‰ï¼Œå®ƒå’Œæˆ‘ä»¬å®šä¹‰çš„ idl æ˜¯å»åˆçš„</p><pre><code class=language-apl>interface OrderManagement {
    Order getOrder(string orderId);
};
</code></pre><pre><code class=language-go>type OrderManagementServant interface {
	GetOrder(orderId string) (ret Order, err error)
}
type OrderManagementServantWithContext interface {
	GetOrder(tarsCtx context.Context, orderId string) (ret Order, err error)
}
</code></pre><p>2ã€æˆ‘ä»¬çš„ä¸šåŠ¡é€»è¾‘å°±æ˜¯å®ç°è¿™ä¸ªæ¥å£</p><pre><code class=language-go>package servant

import (
	&quot;context&quot;
	&quot;net/http&quot;

	&quot;github.com/TarsCloud/TarsGo/tars&quot;

	&quot;github.com/lbbniu/TarsGo-tutorial/order&quot;
)

var orders = make(map[string]order.Order)

type OrderCtx struct {
}

// æœ‰context.Contextå®ç°æœåŠ¡ç«¯
var _ order.OrderManagementServantWithContext = (*OrderCtx)(nil)

func NewOrderCtx() *OrderCtx {
	o := &amp;OrderCtx{}
	o.init()
	return o
}

func (o *OrderCtx) init() {
	orders[&quot;1&quot;] = order.Order{
		Id:          &quot;1&quot;,
		Price:       100,
		Items:       []string{&quot;iPhone 11&quot;, &quot;MacBook Pro&quot;},
		Description: &quot;MacBook Pro&quot;,
		Destination: &quot;Beijing&quot;,
	}
}

func (o *OrderCtx) GetOrder(tarsCtx context.Context, orderId string) (ret order.Order, err error) {
	ord, exists := orders[orderId]
	if exists {
		return ord, nil
	}

	return ord, tars.Errorf(http.StatusNotFound, &quot;Order does not exist. : &quot;, orderId)
}

</code></pre><p>3ã€åœ¨å®ç°å®Œä¸šåŠ¡é€»è¾‘ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºå¹¶å¯åŠ¨æœåŠ¡</p><pre><code class=language-go>package main

import (
	&quot;github.com/TarsCloud/TarsGo/tars&quot;

	&quot;github.com/lbbniu/TarsGo-tutorial/internal/servant&quot;
	&quot;github.com/lbbniu/TarsGo-tutorial/order&quot;
)

func main() {
	cfg := tars.GetServerConfig()
	imp := new(servant.Order)
	app := new(order.OrderManagement)
	app.AddServantWithContext(imp, cfg.App+&quot;.&quot;+cfg.Server+&quot;.orderObj&quot;)
	tars.Run()
}
</code></pre><h3 id=æœåŠ¡ç«¯é…ç½®è¯¦è§£>æœåŠ¡ç«¯é…ç½®è¯¦è§£</h3><p><code>tars.GetServerConfig()</code>è¿”å›æœåŠ¡ç«¯é…ç½®ï¼Œå…¶å®šä¹‰å¦‚ä¸‹:</p><pre><code class=language-go>type adapterConfig struct {
	Endpoint endpoint.Endpoint
	Protocol string
	Obj      string
	Threads  int
}

type serverConfig struct {
	Node     string
	App      string
	Server   string
	LogPath  string
	LogSize  uint64
	LogNum   uint64
	LogLevel string
	Version  string
	LocalIP  string
	Local    string
	BasePath string
	DataPath string
	Config   string
	Notify   string
	Log      string
	Adapters map[string]adapterConfig

	Container   string
	Isdocker    bool
	Enableset   bool
	Setdivision string
	// add server timeout
	AcceptTimeout time.Duration
	ReadTimeout   time.Duration
	WriteTimeout  time.Duration
	HandleTimeout time.Duration
	IdleTimeout   time.Duration
	ZombieTimeout time.Duration
	QueueCap      int
	// add tcp config
	TCPReadBuffer  int
	TCPWriteBuffer int
	TCPNoDelay     bool
	// add routine number
	MaxInvoke int32
	// add adapter &amp; report config
	PropertyReportInterval  time.Duration
	StatReportInterval      time.Duration
	MainLoopTicker          time.Duration
	StatReportChannelBufLen int32
	MaxPackageLength        int
	GracedownTimeout        time.Duration

	// tls
	CA           string
	Cert         string
	Key          string
	VerifyClient bool
	Ciphers      string

	SampleRate     float64
	SampleType     string
	SampleAddress  string
	SampleEncoding string
}
</code></pre><h4 id=æ ¸å¿ƒé…ç½®è¯´æ˜>æ ¸å¿ƒé…ç½®è¯´æ˜</h4><ul><li>Node: æœ¬åœ° tarsnode åœ°å€ï¼Œåªæœ‰ä½ ä½¿ç”¨ tars å¹³å°éƒ¨ç½²æ‰ä¼šä½¿ç”¨è¿™ä¸ªå‚æ•°.</li><li>APP: åº”ç”¨å.</li><li>Server: æœåŠ¡å.</li><li>LogPath: ä¿å­˜æ—¥å¿—çš„ç›®å½•.</li><li>LogSize: è½®æ¢æ—¥å¿—çš„å¤§å°.</li><li>LogLevel: è½®æ¢æ—¥å¿—çš„çº§åˆ«.</li><li>Version: Tarsg çš„ç‰ˆæœ¬.</li><li>LocalIP: æœ¬åœ° ip åœ°å€.</li><li>BasePath: äºŒè¿›åˆ¶æ–‡ä»¶çš„åŸºæœ¬è·¯å¾„.</li><li>DataPath: ä¸€äº›ç¼“å­˜æ–‡ä»¶å­˜å‚¨è·¯å¾„.</li><li>Config: è·å–é…ç½®çš„é…ç½®ä¸­å¿ƒï¼Œå¦‚ tars.tarsconfig.ConfigObj</li><li>Notifyï¼š ä¸ŠæŠ¥é€šçŸ¥æŠ¥å‘Šçš„é€šçŸ¥ä¸­å¿ƒï¼Œå¦‚ tars.tarsnotify.NotifyObj</li><li>Logï¼š è¿œç¨‹æ—¥å¿—ä¸­å¿ƒï¼Œå¦‚ tars.tarslog.LogObj</li><li>Adapters: æ¯ä¸ª adapter é€‚é…å™¨çš„æŒ‡å®šé…ç½®.</li><li>Contianer: ä¿ç•™ä¾›ä»¥åä½¿ç”¨ï¼Œç”¨äºå­˜å‚¨å®¹å™¨åç§°.</li><li>Isdocker: ä¿ç•™ä¾›ä»¥åä½¿ç”¨ï¼Œç”¨äºæŒ‡å®šæœåŠ¡æ˜¯å¦åœ¨å®¹å™¨å†…è¿è¡Œ.</li><li>Enableset: å¦‚æœä½¿ç”¨äº† setï¼Œåˆ™ä¸º True.</li><li>Setdivision: æŒ‡å®šå“ªä¸ª setï¼Œå¦‚ gray.sz.*</li></ul><h3 id=ç¼–å†™å¯åŠ¨é…ç½®æ–‡ä»¶configconfigconf>ç¼–å†™å¯åŠ¨é…ç½®æ–‡ä»¶<code>config/config.conf</code></h3><pre><code class=language-conf>&lt;tars&gt;
    &lt;application&gt;
        &lt;server&gt;
            app=Test
            server=OrderServer
            local=tcp -h 127.0.0.1 -p 10027 -t 30000
            logpath=/tmp
            &lt;Test.OrderServer.OrderObjAdapter&gt;
                allow
                endpoint=tcp -h 127.0.0.1 -p 8080 -t 60000
                handlegroup=Test.OrderServer.OrderObjAdapter
                maxconns=200000
                protocol=tars
                queuecap=10000
                queuetimeout=60000
                servant=Test.OrderServer.OrderObj
                shmcap=0
                shmkey=0
                threads=1
            &lt;/Test.OrderServer.OrderObjAdapter&gt;
        &lt;/server&gt;
    &lt;/application&gt;
&lt;/tars&gt;
</code></pre><p><code>Test.OrderServer.OrderObjAdapter</code>é…ç½®æ®µä¸ºé€‚é…å™¨å¯¹è±¡ç»‘å®š ip å’Œç«¯å£ï¼Œåœ¨æœåŠ¡ç«¯ä»£ç å®ç°çš„ä¾‹å­ä¸­ï¼Œ <code>app.AddServantWithContext(imp, cfg.App+"."+cfg.Server+".orderObj")</code>å®Œæˆ OrderObj çš„é€‚é…å™¨é…ç½®å’Œå®ç°çš„ç»‘å®šã€‚</p><h3 id=æœåŠ¡ç«¯å¯åŠ¨>æœåŠ¡ç«¯å¯åŠ¨</h3><pre><code class=language-bash>go build -o OrderServer
./OrderServer --config=config/config.conf
</code></pre><h2 id=client-å®ç°>client å®ç°</h2><p>ç”¨æˆ·å¯ä»¥è½»æ¾ç¼–å†™å®¢æˆ·ç«¯ä»£ç ï¼Œè€Œæ— éœ€ç¼–å†™ä»»ä½•æŒ‡å®šåè®®çš„é€šä¿¡ä»£ç .</p><h3 id=æ— contextcontentè°ƒç”¨>æ— <code>context.Content</code>è°ƒç”¨</h3><pre><code class=language-go>package main

import (
	&quot;fmt&quot;
	
	&quot;github.com/TarsCloud/TarsGo/tars&quot;

	&quot;github.com/lbbniu/TarsGo-tutorial/order&quot;
)

func main() {
	comm := tars.GetCommunicator()
	client := new(order.OrderManagement)
    obj := &quot;Test.OrderServer.OrderObj@tcp -h 127.0.0.1 -p 8080 -t 60000&quot;
	comm.StringToProxy(obj, client)

	noCtxCall(client)
}

func noCtxCall(client *order.OrderManagement) {
	order, err := client.GetOrder(&quot;1&quot;)
	if err != nil {
		panic(err)
	}
	fmt.Printf(&quot;noctx: %+v\n&quot;, order)
}
</code></pre><ul><li><code>github.com/lbbniu/TarsGo-tutorial/order</code> åŒ…æ˜¯ç”± tars2go å·¥å…·ä½¿ç”¨ tars åè®®æ–‡ä»¶ç”Ÿæˆçš„</li><li>comm: Communicator ç”¨äºä¸æœåŠ¡ç«¯è¿›è¡Œé€šä¿¡ï¼Œå®ƒåº”è¯¥åªåˆå§‹åŒ–ä¸€æ¬¡å¹¶ä¸”æ˜¯å…¨å±€çš„ã€‚</li><li>obj: å¯¹è±¡åç§°ï¼Œç”¨äºæŒ‡å®šæœåŠ¡ç«¯çš„ ip å’Œç«¯å£ã€‚é€šå¸¸åœ¨"@&ldquo;ç¬¦å·ä¹‹å‰æˆ‘ä»¬åªéœ€è¦å¯¹è±¡åç§°ã€‚</li><li>client: ä¸ tars æ–‡ä»¶ä¸­çš„æ¥å£å…³è”çš„åº”ç”¨ç¨‹åºã€‚ åœ¨æœ¬ä¾‹ä¸­å®ƒæ˜¯ <code>order.OrderManagement</code>ã€‚</li><li>StringToProxyï¼šStringToProxy æ–¹æ³•ç”¨äºç»‘å®šå¯¹è±¡åç§°å’Œåº”ç”¨ç¨‹åºï¼Œå¦‚æœä¸è¿™æ ·åšï¼Œé€šä¿¡å™¨å°†ä¸çŸ¥é“è°ä¸åº”ç”¨ç¨‹åºé€šä¿¡ ã€‚</li><li><code>client.GetOrder</code> ç”¨äºè°ƒç”¨ tars æ–‡ä»¶ä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œå¹¶è¿”å› order å’Œ errã€‚</li></ul><h4 id=å®¢æˆ·ç«¯é€šä¿¡å™¨>å®¢æˆ·ç«¯é€šä¿¡å™¨</h4><p>é€šä¿¡å™¨æ˜¯ä¸ºå®¢æˆ·ç«¯å‘é€å’Œæ¥æ”¶åŒ…çš„ä¸€ç»„èµ„æºï¼Œå…¶æœ€ç»ˆç®¡ç†æ¯ä¸ªå¯¹è±¡çš„ socket é€šä¿¡ã€‚åœ¨ä¸€ä¸ªç¨‹åºä¸­ä½ åªéœ€è¦ä¸€ä¸ªé€šä¿¡å™¨ã€‚</p><pre><code class=language-go>comm := tars.NewCommunicator()
comm.SetProperty(&quot;property&quot;, &quot;tars.tarsproperty.PropertyObj&quot;)
comm.SetLocator(&quot;locator&quot;, &quot;tars.tarsregistry.QueryObj@tcp -h ... -p ...&quot;)
</code></pre><p>æè¿°:</p><blockquote><ul><li>é€šä¿¡å™¨é…ç½®æ–‡ä»¶çš„æ ¼å¼å°†åœ¨åé¢æè¿°</li><li>å¯ä»¥åœ¨æ²¡æœ‰é…ç½®æ–‡ä»¶çš„æƒ…å†µä¸‹é…ç½®é€šä¿¡å™¨ï¼Œå¹¶ä¸”æ‰€æœ‰å‚æ•°éƒ½å…·æœ‰é»˜è®¤å€¼</li><li>é€šä¿¡å™¨ä¹Ÿå¯ä»¥é€šè¿‡â€œSetPropertyâ€æ–¹æ³•ç›´æ¥åˆå§‹åŒ–</li><li>å¦‚æœæ‚¨ä¸éœ€è¦é…ç½®æ–‡ä»¶ï¼Œåˆ™å¿…é¡»è‡ªå·±è®¾ç½® locator å‚æ•°</li></ul></blockquote><p>å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶goå®šä¹‰</p><pre><code class=language-go>type clientConfig struct {
	Locator                 string
	Stat                    string
	Property                string
	ModuleName              string
	RefreshEndpointInterval int
	ReportInterval          int
	CheckStatusInterval     int
	KeepAliveInterval       int
	AsyncInvokeTimeout      int
    SyncInvokeTimeout      int
	// add client timeout
	ClientQueueLen     int
	ClientIdleTimeout  time.Duration
	ClientReadTimeout  time.Duration
	ClientWriteTimeout time.Duration
	ClientDialTimeout  time.Duration
	ReqDefaultTimeout  int32
	ObjQueueMax        int32
}
</code></pre><p>å®¢æˆ·ç«¯é€šä¿¡å™¨æ ¸å¿ƒå±æ€§æè¿°:</p><blockquote><ul><li>Locatorï¼šä¸»æ§æœåŠ¡çš„åœ°å€å¿…é¡»é‡‡ç”¨â€œip portâ€æ ¼å¼ã€‚ å¦‚æœä½ ä¸éœ€è¦ä¸»æ§æ¥æŸ¥æ‰¾æœåŠ¡ï¼Œåˆ™æ— éœ€é…ç½®æ­¤é¡¹.</li><li>AsyncInvokeTimeoutï¼šå®¢æˆ·ç«¯å¼‚æ­¥è°ƒç”¨çš„æœ€å¤§è¶…æ—¶æ—¶é—´ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰ï¼Œæ­¤é…ç½®çš„é»˜è®¤å€¼ä¸º 5000.</li><li>SyncInvokeTimeoutï¼šå®¢æˆ·ç«¯åŒæ­¥è°ƒç”¨çš„æœ€å¤§è¶…æ—¶æ—¶é—´ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰ï¼Œæ­¤é…ç½®çš„é»˜è®¤å€¼ä¸º 3000ï¼Œç°åœ¨æ²¡ç”¨äº tarsgoï¼Œåç»­ä¼šæ”¯æŒå¼‚æ­¥å›è°ƒæ¨¡å¼ã€‚</li><li>RefreshEndpointIntervalï¼šå®šæœŸè®¿é—®ä¸»æ§ä»¥è·å–ä¿¡æ¯çš„æ—¶é—´é—´éš”ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰ï¼Œæ­¤é…ç½®çš„é»˜è®¤å€¼ä¸ºä¸€åˆ†é’Ÿ.</li><li>Statï¼šåœ¨æ¨¡å—ä¹‹é—´è°ƒç”¨çš„æœåŠ¡çš„åœ°å€ã€‚ å¦‚æœæœªé…ç½®æ­¤é¡¹ï¼Œåˆ™è¡¨ç¤ºå°†ç›´æ¥ä¸¢å¼ƒä¸ŠæŠ¥çš„æ•°æ®.</li><li>Propertyï¼šæœåŠ¡ä¸ŠæŠ¥å…¶å±æ€§çš„åœ°å€ã€‚ å¦‚æœæœªé…ç½®ï¼Œåˆ™è¡¨ç¤ºå°†ç›´æ¥ä¸¢å¼ƒä¸ŠæŠ¥çš„æ•°æ®.</li><li>ReportIntervalï¼šç°åœ¨TarsGoä¸­é…ç½®æ— æ•ˆï¼Œåç»­ä¼šæ”¯æŒæ­¤å‚æ•°ã€‚</li><li>ModuleName: æ¨¡å—åç§°ï¼Œé»˜è®¤å€¼æ˜¯å¯æ‰§è¡Œç¨‹åºçš„åç§°ã€‚</li></ul></blockquote><p>é€šä¿¡å™¨é…ç½®æ–‡ä»¶çš„æ ¼å¼å¦‚ä¸‹ï¼š</p><pre><code class=language-xml>&lt;tars&gt;
  &lt;application&gt;
    #The configuration required by the proxy
    &lt;client&gt;
        #address
        locator = tars.tarsregistry.QueryObj@tcp -h 127.0.0.1 -p 17890
        #The maximum timeout (in milliseconds) for synchronous calls.
        sync-invoke-timeout         = 3000
        #The maximum timeout (in milliseconds) for asynchronous calls.
        async-invoke-timeout        = 5000
        #The maximum timeout (in milliseconds) for synchronous calls.
        refresh-endpoint-interval   = 60000
        #Used for inter-module calls
        stat                        = tars.tarsstat.StatObj
        #Address used for attribute reporting
        property                    = tars.tarsproperty.PropertyObj
        #report time interval
        report-interval             = 60000
        #The module name
        modulename                  = Test.OrderServer
    &lt;/client&gt;
  &lt;/application&gt;
&lt;/tars&gt;
</code></pre><h3 id=æœ‰contextcontentè°ƒç”¨>æœ‰<code>context.Content</code>è°ƒç”¨</h3><pre><code class=language-go>func ctxCall(client *order.OrderManagement) {
	order, err := client.GetOrderWithContext(context.Background(), &quot;1&quot;)
	if err != nil {
		panic(err)
	}
	fmt.Printf(&quot;ctx: %+v\n&quot;, order)
}
</code></pre><h3 id=å•å‘è°ƒç”¨oneway>å•å‘è°ƒç”¨ï¼ˆOneWayï¼‰</h3><pre><code class=language-go>// å•å‘è°ƒç”¨ï¼Œæ— è¿”å›å€¼ï¼Œç›®å‰å‡½æ•°å‰é¢ä¼šæœ‰è¿”å›å€¼ï¼Œåç»­tars2goä¸­ä¼šå»æ‰
func oneWayCall(client *order.OrderManagement) {
	_, err := client.GetOrderOneWayWithContext(context.Background(), &quot;1&quot;)
	if err != nil {
		panic(err)
	}
    fmt.Println(&quot;oneway&quot;)
}
</code></pre><h3 id=å–æ¨¡å“ˆå¸Œè°ƒç”¨>å–æ¨¡å“ˆå¸Œè°ƒç”¨</h3><pre><code class=language-go>// å–æ¨¡è°ƒç”¨
func modHashCall(client *order.OrderManagement) {
	ctx := current.ContextWithClientCurrent(context.Background())
	var hashCode uint32 = 1
	current.SetClientHash(ctx, int(tars.ModHash), hashCode)
	order, err := client.GetOrderWithContext(context.Background(), &quot;1&quot;)
	if err != nil {
		panic(err)
	}
	fmt.Printf(&quot;ModHash: %+v\n&quot;, order)
}
</code></pre><h3 id=ä¸€è‡´æ€§å“ˆå¸Œè°ƒç”¨>ä¸€è‡´æ€§å“ˆå¸Œè°ƒç”¨</h3><pre><code class=language-go>// ä¸€è‡´æ€§å“ˆå¸Œè°ƒç”¨
func consistentHashCall(client *order.OrderManagement) {
	ctx := current.ContextWithClientCurrent(context.Background())
	var hashCode uint32 = 1
	current.SetClientHash(ctx, int(tars.ConsistentHash), hashCode)
	order, err := client.GetOrderWithContext(context.Background(), &quot;1&quot;)
	if err != nil {
		panic(err)
	}
	fmt.Printf(&quot;ConsistentHash: %+v\n&quot;, order)
}
</code></pre><h2 id=å°ç»“>å°ç»“</h2><p>ç»è¿‡ä¸Šé¢çš„å­¦ä¹ ï¼Œæˆ‘ä»¬ä¸€æ­¥æ­¥å®Œæˆäº†åè®®ã€æœåŠ¡ç«¯ã€å®¢æˆ·ç«¯çš„ç¼–å†™ï¼Œç°åœ¨å¯ä»¥è½»æ¾å®ŒæˆTarsGoé¡¹ç›®çš„å¼€å‘äº†ã€‚</p><p>ä¸è¿‡ä¸Šé¢æ‰‹åŠ¨åˆ›å»ºé¡¹ç›®çš„éª¨æ¶ç»“æ„çš„è¿‡ç¨‹å®Œå…¨å¯ä»¥è‡ªåŠ¨åŒ–ï¼ŒTarsGoæä¾›äº†<code>tarsgo</code>è„šæ‰‹æ¶ä¸€é”®åˆ›å»ºé¡¹ç›®ã€‚ä¸‹é¢è¿›è¡Œæ¼”ç¤ºã€‚</p><h3 id=å®‰è£…>å®‰è£…</h3><pre><code class=language-bash>go install github.com/TarsCloud/TarsGo/tars/tools/tarsgo@latest
</code></pre><ul><li>æ³¨æ„è¿™é‡Œå®‰è£…çš„æ˜¯<code>tarsgo</code>è„šæ‰‹æ¶ï¼Œå¹¶é<code>tars2go</code>åè®®å¤„ç†å·¥å…·</li><li>æˆªæ­¢ç›®å‰æœ€æ–°ç‰ˆæœ¬ä¸º v1.3.6</li></ul><h3 id=å¸®åŠ©>å¸®åŠ©</h3><p>ç›´æ¥æ‰§è¡Œ<code>tarsgo</code></p><pre><code class=language-bash>tarsgo: An elegant toolkit for Go microservices.

Usage:
  tarsgo [command]

Available Commands:
  cmake       Create a service cmake template
  completion  Generate the autocompletion script for the specified shell
  help        Help about any command
  make        Create a server make template
  upgrade     Auto upgrade tarsgo and tars2go

Flags:
  -h, --help      help for tarsgo
  -v, --version   version for tarsgo

Use &quot;tarsgo [command] --help&quot; for more information about a command.
</code></pre><p><code>tarsgo</code>å¯ä»¥å·²åˆ›å»º<code>cmake</code>å’Œ<code>make</code>ç®¡ç†çš„é¡¹ç›®ï¼Œä¸‹é¢åªå±•ç¤º<code>make</code>ç®¡ç†é¡¹ç›®çš„åˆ›å»ºæ¼”ç¤ºï¼Œå› ä¸º<code>cmake</code>ä¹Ÿç±»ä¼¼ã€‚</p><h3 id=åˆ›å»ºé¡¹ç›®>åˆ›å»ºé¡¹ç›®</h3><h3 id=å‘½ä»¤>å‘½ä»¤</h3><pre><code>tarsgo make Test HelloGo Hello github.com/lbbniu/TarsGo-tutorial/HelloGo
</code></pre><h4 id=æ‰§è¡Œç»“æœ>æ‰§è¡Œç»“æœ</h4><pre><code class=language-bash>ğŸš€ Creating server Test.HelloGo, please wait a moment.

go: creating new go.mod: module github.com/lbbniu/TarsGo-tutorial/HelloGo
go: to add module requirements and sums:
	go mod tidy

CREATED HelloGo/Hello.tars (165 bytes)
CREATED HelloGo/Hello_imp.go (602 bytes)
CREATED HelloGo/Makefile (154 bytes)
CREATED HelloGo/client/client.go (450 bytes)
CREATED HelloGo/config/config.conf (689 bytes)
CREATED HelloGo/debugtool/dumpstack.go (406 bytes)
CREATED HelloGo/go.mod (58 bytes)
CREATED HelloGo/main.go (520 bytes)
CREATED HelloGo/scripts/makefile.tars.gomod.mk (6308 bytes)
CREATED HelloGo/start.sh (63 bytes)

&gt;&gt;&gt; Greatï¼Done! You can jump in HelloGo
&gt;&gt;&gt; Tips: After editing the Tars file, execute the following cmd to automatically generate golang files.
&gt;&gt;&gt;       /bin/tars2go *.tars
$ cd HelloGo
$ ./start.sh
ğŸ¤ Thanks for using TarsGo
ğŸ“š Tutorial: https://doc.tarsyun.com/
</code></pre><ul><li>ç°åœ¨å¯ä»¥è¿›å…¥<code>HelloGo</code>ç›®å½•æ‰§è¡Œ<code>./start.sh</code>å¯åŠ¨æœåŠ¡ç«¯ç¨‹åºäº†ï¼Œæ˜¯ä¸æ˜¯å¾ˆç®€å•å•Šã€‚</li><li>åç»­è„šæ‰‹æ¶ä¼šä¼˜åŒ–éª¨æ¶é¡¹ç›®ç»“æ„ã€‚</li></ul><h2 id=ç¤ºä¾‹ä»£ç >ç¤ºä¾‹ä»£ç </h2><p><a href=https://github.com/lbbniu/TarsGo-tutorial.git target=_blank rel=noopener>https://github.com/lbbniu/TarsGo-tutorial.git</a></p><p><img src=https://gitee.com/lbbniu/typora/raw/master/qrcode_for_gh_4ab47aa64a20_258.jpg alt=å…¬ä¼—å·ï¼šåˆ˜å…µå…µ></p></article><div class=my-4><a href=/tags/tars/ class="inline-block bg-tertiary-bg text-sm rounded px-3 py-1 my-1 me-2 hover:text-eureka">#Tars</a></div><div class=py-2><div class="my-8 flex flex-col items-center md:flex-row"><a href=/authors/lbbniu/ class="md:me-4 text-primary-text h-24 w-24"><i class="fas fa-user-circle fa-6x"></i></a><div class="mt-4 w-full md:mt-0 md:w-auto"><a href=/authors/lbbniu/ class="mb-2 block border-b pb-1 text-lg font-bold"><h3>lbbniu</h3></a><span class="block pb-2"></span></div></div></div><div class="-mx-2 mt-4 flex flex-col border-t px-2 pt-4 md:flex-row md:justify-between"><div><span class="text-primary-text block font-bold">ä¸Šä¸€é¡µ</span>
<a href=/2023/06/18/tarsgo-protocol/ class=block>å†™ç»™goå¼€å‘è€…çš„Tarsæ•™ç¨‹-Tarsåè®®åŸºç¡€</a></div><div class="mt-4 md:mt-0 md:text-right"><span class="text-primary-text block font-bold">ä¸‹ä¸€é¡µ</span>
<a href=/2023/03/26/redis-cluster-vs-codis-slot-rebalance-%E7%AE%97%E6%B3%95/ class=block>Redis Cluster vs Codis Slot Rebalance ç®—æ³•</a></div></div></div><div class=col-span-2><div class="bg-primary-bg
prose sticky top-16 z-10 hidden px-6 py-4 lg:block"><h3>æœ¬é¡µå†…å®¹</h3></div><div class="sticky-toc hidden px-6 pb-6 lg:block"><nav id=TableOfContents><ul><li><a href=#tars-ç¤ºä¾‹-idl>Tars ç¤ºä¾‹ IDL</a><ul><li><a href=#ç”Ÿæˆ-go-åè®®ç¼–è§£ç ä»£ç >ç”Ÿæˆ go åè®®ç¼–è§£ç ä»£ç </a></li></ul></li><li><a href=#server-å®ç°>server å®ç°</a><ul><li><a href=#æœåŠ¡ç«¯å¼€å‘>æœåŠ¡ç«¯å¼€å‘</a></li><li><a href=#æœåŠ¡ç«¯é…ç½®è¯¦è§£>æœåŠ¡ç«¯é…ç½®è¯¦è§£</a><ul><li><a href=#æ ¸å¿ƒé…ç½®è¯´æ˜>æ ¸å¿ƒé…ç½®è¯´æ˜</a></li></ul></li><li><a href=#ç¼–å†™å¯åŠ¨é…ç½®æ–‡ä»¶configconfigconf>ç¼–å†™å¯åŠ¨é…ç½®æ–‡ä»¶<code>config/config.conf</code></a></li><li><a href=#æœåŠ¡ç«¯å¯åŠ¨>æœåŠ¡ç«¯å¯åŠ¨</a></li></ul></li><li><a href=#client-å®ç°>client å®ç°</a><ul><li><a href=#æ— contextcontentè°ƒç”¨>æ— <code>context.Content</code>è°ƒç”¨</a><ul><li><a href=#å®¢æˆ·ç«¯é€šä¿¡å™¨>å®¢æˆ·ç«¯é€šä¿¡å™¨</a></li></ul></li><li><a href=#æœ‰contextcontentè°ƒç”¨>æœ‰<code>context.Content</code>è°ƒç”¨</a></li><li><a href=#å•å‘è°ƒç”¨oneway>å•å‘è°ƒç”¨ï¼ˆOneWayï¼‰</a></li><li><a href=#å–æ¨¡å“ˆå¸Œè°ƒç”¨>å–æ¨¡å“ˆå¸Œè°ƒç”¨</a></li><li><a href=#ä¸€è‡´æ€§å“ˆå¸Œè°ƒç”¨>ä¸€è‡´æ€§å“ˆå¸Œè°ƒç”¨</a></li></ul></li><li><a href=#å°ç»“>å°ç»“</a><ul><li><a href=#å®‰è£…>å®‰è£…</a></li><li><a href=#å¸®åŠ©>å¸®åŠ©</a></li><li><a href=#åˆ›å»ºé¡¹ç›®>åˆ›å»ºé¡¹ç›®</a></li><li><a href=#å‘½ä»¤>å‘½ä»¤</a><ul><li><a href=#æ‰§è¡Œç»“æœ>æ‰§è¡Œç»“æœ</a></li></ul></li></ul></li><li><a href=#ç¤ºä¾‹ä»£ç >ç¤ºä¾‹ä»£ç </a></li></ul></nav></div><script>window.addEventListener("DOMContentLoaded",()=>{enableStickyToc()})</script></div><div class="bg-secondary-bg prose col-span-2 rounded p-6 lg:col-span-6"><h3>ç›¸å…³</h3><a href=/2023/06/18/tarsgo-protocol/ class=no-underline>å†™ç»™goå¼€å‘è€…çš„Tarsæ•™ç¨‹-Tarsåè®®åŸºç¡€</a><br><a href=/cloud-native/tars%E5%AE%B9%E5%99%A8%E5%8C%96/ class=no-underline>TarsæœåŠ¡å®¹å™¨åŒ–</a><br></div></div><script>document.addEventListener("DOMContentLoaded",()=>{hljs.highlightAll()})</script></div></div></main><footer class=pl-scrollbar><div class="mx-auto w-full max-w-screen-xl"><div class="text-center p-6 pin-b"><p class="text-sm text-tertiary-text">&copy; 2021 <a href=https://blog.lbbniu.com/>lbbniu</a>
&#183; Powered by the <a href=https://github.com/wangchucheng/hugo-eureka class=hover:text-eureka>Eureka</a> theme for <a href=https://gohugo.io class=hover:text-eureka>Hugo</a></p></div></div></footer></body></html>