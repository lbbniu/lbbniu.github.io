<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>m3u8 on lbbniu</title><link>/tags/m3u8/</link><description>Recent content in m3u8 on lbbniu</description><generator>Hugo -- gohugo.io</generator><language>zh</language><managingEditor>lbbniu@gmail.com (lbbniu)</managingEditor><webMaster>lbbniu@gmail.com (lbbniu)</webMaster><copyright>&amp;copy; 2021 &lt;a href="https://blog.lbbniu.com/">lbbniu&lt;/a></copyright><lastBuildDate>Wed, 08 Mar 2023 15:20:00 +0800</lastBuildDate><atom:link href="/tags/m3u8/index.xml" rel="self" type="application/rss+xml"/><item><title>云上虎视频下载分析</title><link>/2023/03/08/%E4%BA%91%E4%B8%8A%E8%99%8E%E8%A7%86%E9%A2%91%E4%B8%8B%E8%BD%BD%E5%88%86%E6%9E%90/</link><pubDate>Wed, 08 Mar 2023 15:20:00 +0800</pubDate><author>lbbniu@gmail.com (lbbniu)</author><guid>/2023/03/08/%E4%BA%91%E4%B8%8A%E8%99%8E%E8%A7%86%E9%A2%91%E4%B8%8B%E8%BD%BD%E5%88%86%E6%9E%90/</guid><description>声明 本文章中所有内容仅供学习交流使用，不用于其他任何目的，不提供完整代码，抓包内容、敏感网址、数据接口等均已做脱敏处理，严禁用于商业用途和非法用途，否则由此产生的一切后果均与作者无关！
本文章未经许可禁止转载，禁止任何修改后二次传播，擅自使用本文讲解的技术而导致的任何意外，作者均不负责，若有侵权，请在公众号【程序员大兵】联系作者立即删除！
逆向分析 首先打开网课网站并登录账号，进入视频播放页面，然后打开开发者者工具看下Fetch/XHR类型网络请求。如下图所示：
从上图Fetch/XHR类型网络请求中可以看到有请求阿里云视频播放信息接口的请求，可以展开对应请求看具体的请求信息，如下图所示：
观察网络请求，并没有发现有请求获取阿里云播放请求的PlayAuth的获取接口，从而可以推测出PlayAuth信息不是通过单独网站业务接口获取，可能是通过内嵌在网页的html中，下面通过右键点击网页选择显示网页源代码，如下图所示进行操作：
打开网页源代码之后，搜索PlayAuth关键字进行定位关键信息，看是否能找到我们想要的的东西，如下图所示果然从网页源代码中找到了PlayAuth，找到PlayAuth之后响应下载对应视频就很简单了，只用使用我的 https://github.com/lbbniu/aliyun-m3u8-downloader 项目就可以轻松搞定了。从源代码中我们还可以看到有初始化Aliplayer的相关代码。
下面演示下获取到PlayAuth之后如何使用 https://github.com/lbbniu/aliyun-m3u8-downloader 工具信息视频下载，如下图演示所示可以成功进行m3u8视频下载
作为低级程序员，通过手动复制PlayAuth进行一个一个视频下载还是太麻烦和耗费视频了，如果可以通过程序输入对应视频课程地址自动获取课程下所有课程链接和PlayAuth就可以解放双手了。下面分析如何通过程序完成自动化的视频下载单个课程下的所有视频。
通过网站请求分析可以知道，网站是通过cookie中token进行用户身份鉴定和鉴权的。如下图：
接下来首先使用github.com/ddliu/go-httpclient构造请求网站的httpclient，如下代码所示 ：
var huohujiaoyuClient *httpclient.HttpClient huohujiaoyuClient = httpclient.NewHttpClient() token := &amp;quot;&amp;lt;cookie 中 token&amp;gt;&amp;quot; huohujiaoyuClient.Defaults(httpclient.Map{ &amp;quot;Accept&amp;quot;: &amp;quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&amp;quot;, &amp;quot;Connection&amp;quot;: &amp;quot;keep-alive&amp;quot;, &amp;quot;Cookie&amp;quot;: fmt.Sprintf(&amp;quot;token=%s&amp;quot;, token), httpclient.OPT_USERAGENT: &amp;quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/109.0.0.0 Safari/537.36&amp;quot;, }) 对网站源码分析后，可以得知同html代码可以提取整个课程知识讲解 和案例教材的所有视频播放地址的链接地址。如下所示：
提取html中视频播放链接地址我们可以使用 github.com/PuerkitoBio/goquery完成html数据提取，接下来我们使用httpclient 获取网页内容，并通过goquery 解析html分别获取知识讲解 和案例教材的对	div元素：
resp, err := huohujiaoyuClient.Get(url) if err != nil { log.Fatalln(err) } doc, err := goquery.NewDocumentFromReader(resp.Body) if err !</description></item></channel></rss>