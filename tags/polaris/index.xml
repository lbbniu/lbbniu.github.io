<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>polaris on lbbniu</title><link>/tags/polaris/</link><description>Recent content in polaris on lbbniu</description><generator>Hugo -- gohugo.io</generator><language>zh</language><managingEditor>lbbniu@gmail.com (lbbniu)</managingEditor><webMaster>lbbniu@gmail.com (lbbniu)</webMaster><copyright>&amp;copy; 2021 &lt;a href="https://blog.lbbniu.com/">lbbniu&lt;/a></copyright><lastBuildDate>Fri, 28 Oct 2022 15:20:00 +0800</lastBuildDate><atom:link href="/tags/polaris/index.xml" rel="self" type="application/rss+xml"/><item><title>polaris-go 源码走读</title><link>/2022/10/28/polaris-go/</link><pubDate>Fri, 28 Oct 2022 15:20:00 +0800</pubDate><author>lbbniu@gmail.com (lbbniu)</author><guid>/2022/10/28/polaris-go/</guid><description>provider 实例化ProviderAPI NewProviderAPI() -&amp;gt; 根据默认配置文件./polaris.yaml 实例化 api.newProviderAPI-&amp;gt;api.newProviderAPIByConfig-&amp;gt;api.InitContextByConfig-&amp;gt;[api.newProviderAPIByContext]-&amp;gt;&amp;amp;providerAPI{rawAPI: p} NewProviderAPIByFile(path string) -&amp;gt; 根据指定配置文件实例化 api.newProviderAPIByFile-&amp;gt;api.InitContextByFile-&amp;gt;api.InitContextByStream-&amp;gt;api.InitContextByConfig-&amp;gt;[api.newProviderAPIByContext]-&amp;gt;&amp;amp;providerAPI{rawAPI: p} NewProviderAPIByConfig(cfg config.Configuration) -&amp;gt; 根据指定配置实例化 api.newProviderAPIByConfig-&amp;gt;api.InitContextByConfig-&amp;gt;[api.newProviderAPIByContext] NewProviderAPIByContext(context api.SDKContext) -&amp;gt; 根据指定api.SDKContext实例化 api.newProviderAPIByContext-&amp;gt;&amp;amp;providerAPI{rawAPI: p} NewProviderAPIByAddress(address &amp;hellip;string) -&amp;gt; 根据指定 polaris-server 地址实例化 api.newProviderAPIByAddress-&amp;gt;[config.NewDefaultConfiguration]-&amp;gt;api.newProviderAPIByConfig-&amp;gt;api.InitContextByConfig-&amp;gt;[api.newProviderAPIByContext]-&amp;gt;&amp;amp;providerAPI{rawAPI: p} 以上所有方法最终都会走到api.newProviderAPIByContex方法, 然后返回&amp;amp;providerAPI{rawAPI: p}
![image-20221104120449226](/Users/lbbniu/Library/Application Support/typora-user-images/image-20221104120449226.png)
相关接口定义 // ProviderAPI CL5服务端API的主接口 type ProviderAPI interface { // RegisterInstance // minimum supported version of polaris-server is v1.10.0 RegisterInstance(instance *InstanceRegisterRequest) (*model.InstanceRegisterResponse, error) // Deregister synchronize the anti registration service Deregister(instance *InstanceDeRegisterRequest) error // Destroy the api is destroyed and cannot be called again Destroy() } RegisterInstance // providerAPI 调用者对外函数实现 type providerAPI struct { rawAPI api.</description></item></channel></rss>