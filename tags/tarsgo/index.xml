<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>tarsgo on lbbniu</title><link>/tags/tarsgo/</link><description>Recent content in tarsgo on lbbniu</description><generator>Hugo -- gohugo.io</generator><language>zh</language><managingEditor>lbbniu@gmail.com (lbbniu)</managingEditor><webMaster>lbbniu@gmail.com (lbbniu)</webMaster><copyright>&amp;copy; 2021 &lt;a href="https://blog.lbbniu.com/">lbbniu&lt;/a></copyright><lastBuildDate>Wed, 10 Jan 2024 15:20:00 +0800</lastBuildDate><atom:link href="/tags/tarsgo/index.xml" rel="self" type="application/rss+xml"/><item><title>å†™ç»™Goå¼€å‘è€…çš„Tarsæ•™ç¨‹-è¶…æ—¶æ§åˆ¶</title><link>/2024/01/10/tarsgo-timeout/</link><pubDate>Wed, 10 Jan 2024 15:20:00 +0800</pubDate><author>lbbniu@gmail.com (lbbniu)</author><guid>/2024/01/10/tarsgo-timeout/</guid><description>æœ¬ç¯‡ä¸ºã€å†™ç»™goå¼€å‘è€…çš„Tarsæ•™ç¨‹ã€‘ç³»åˆ—ç¬¬å…­ç¯‡
ç¬¬ä¸€ç¯‡ï¼šTarsåè®®åŸºç¡€ ç¬¬äºŒç¯‡ï¼šé€šä¿¡æ¨¡å¼ ç¬¬ä¸‰ç¯‡ï¼šæ‹¦æˆªå™¨ ç¬¬å››ç¯‡ï¼šé”™è¯¯å¤„ç† ç¬¬äº”ç¯‡ï¼šcontext/status ç¬¬å…­ç¯‡ï¼šè¶…æ—¶æ§åˆ¶
æœ¬ç³»åˆ—å°†æŒç»­æ›´æ–°ï¼Œæ¬¢è¿å…³æ³¨ğŸ‘è·å–å®æ—¶é€šçŸ¥
å¯¼è¨€
ä¸€ä¸ªåˆç†çš„è¶…æ—¶æ—¶é—´æ˜¯éå¸¸å¿…è¦çš„ï¼Œå®ƒèƒ½æé«˜ç”¨æˆ·ä½“éªŒï¼Œæé«˜æœåŠ¡å™¨çš„æ•´ä½“æ€§èƒ½ï¼Œæ˜¯æœåŠ¡æ²»ç†çš„å¸¸è§æ‰‹æ®µä¹‹ä¸€
ä¸ºä»€ä¹ˆè¦è®¾ç½®è¶…æ—¶ ç”¨æˆ·ä½“éªŒï¼šå¾ˆå¤šRPCéƒ½æ˜¯ç”±ç”¨æˆ·ä¾§å‘èµ·ï¼Œå¦‚æœè¯·æ±‚ä¸è®¾ç½®è¶…æ—¶æ—¶é—´æˆ–è€…è¶…æ—¶æ—¶é—´ä¸åˆç†ï¼Œä¼šå¯¼è‡´ç”¨æˆ·ä¸€ç›´å¤„äºç™½å±æˆ–è€…è¯·æ±‚ä¸­çš„çŠ¶æ€ï¼Œå½±å“ç”¨æˆ·çš„ä½“éªŒ
èµ„æºåˆ©ç”¨ï¼šä¸€ä¸ªRPCä¼šå ç”¨ä¸¤ç«¯ï¼ˆæœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯ï¼‰ç«¯å£ã€cpuã€å†…å­˜ç­‰ä¸€ç³»åˆ—çš„èµ„æºï¼Œä¸åˆç†çš„è¶…æ—¶æ—¶é—´ä¼šå¯¼è‡´RPCå ç”¨çš„èµ„æºè¿Ÿè¿Ÿä¸èƒ½è¢«é‡Šæ”¾ï¼Œå› è€Œå½±å“æœåŠ¡å™¨ç¨³å®šæ€§
ç»¼ä¸Šï¼Œä¸€ä¸ªåˆç†çš„è¶…æ—¶æ—¶é—´æ˜¯éå¸¸å¿…è¦çš„ã€‚åœ¨ä¸€äº›è¦æ±‚æ›´é«˜çš„æœåŠ¡ä¸­ï¼Œæˆ‘ä»¬è¿˜éœ€è¦é’ˆå¯¹DNSè§£æã€è¿æ¥å»ºç«‹ï¼Œè¯»ã€å†™ç­‰è®¾ç½®æ›´ç²¾ç»†çš„è¶…æ—¶æ—¶é—´ã€‚é™¤äº†è®¾ç½®é™æ€çš„è¶…æ—¶æ—¶é—´ï¼Œæ ¹æ®å½“å‰ç³»ç»ŸçŠ¶æ€ã€æœåŠ¡é“¾è·¯ç­‰è®¾ç½®è‡ªé€‚åº”çš„åŠ¨æ€è¶…æ—¶æ—¶é—´ä¹Ÿæ˜¯æœåŠ¡æ²»ç†ä¸­ä¸€ä¸ªå¸¸è§çš„æ–¹æ¡ˆã€‚
å®¢æˆ·ç«¯çš„è¶…æ—¶ è¿æ¥è¶…æ—¶ è¿˜è®°å¾—æˆ‘ä»¬æ€ä¹ˆåœ¨å®¢æˆ·ç«¯åˆ›å»ºçš„ä¹ˆï¼Ÿ
comm := tars.GetCommunicator() client := new(order.OrderManagement) obj := &amp;quot;Test.OrderServer.OrderObj@tcp -h 127.0.0.1 -p 8080 -t 60000&amp;quot; comm.StringToProxy(obj, client) // order, err := client.GetOrderWithContext(ctx, &amp;quot;1&amp;quot;) // if err != nil { // panic(err) // } å¦‚æœç›®æ ‡åœ°å€tcp -h 127.0.0.1 -p 8080 -t 60000æ— æ³•å»ºç«‹è¿æ¥ï¼Œcomm.StringToProxyä¼šå‡ºç°é”™è¯¯æˆ–panicä¹ˆï¼Ÿè¿™é‡Œç›´æ¥æ”¾ç»“è®ºï¼šä¸ä¼šçš„ï¼ŒTarsGoåªæœ‰åœ¨å‘ç”ŸRPCè°ƒç”¨æ—¶æ‰ä¼šåˆ›å»ºè¿æ¥ï¼Œå¹¶ä¸ä¼šé˜»å¡åœ¨è¿™é‡Œï¼Œå¦‚æœRPCè°ƒç”¨æ—¶è¿æ¥æ²¡æœ‰åˆ›å»ºæˆåŠŸä¼šåœ¨RPCè°ƒç”¨ä¸­æŠ¥é”™ã€‚
å¦‚æœæˆ‘ä»¬æƒ³æ§åˆ¶è¿æ¥åˆ›å»ºæ—¶çš„è¶…æ—¶æ—¶é—´è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ
å¯ä»¥ä¿®æ”¹TarsæœåŠ¡çš„å¯åŠ¨é…ç½®æ–‡ä»¶å¯¹åº”çš„é…ç½®é¡¹æ¥å®Œæˆï¼Œç›®å‰ä¹Ÿåªèƒ½é€šè¿‡é…ç½®æ–‡ä»¶è¿›é…ç½®ã€‚é»˜è®¤é“¾æ¥è¶…æ—¶æ—¶é—´ä¸º3000æ¯«ç§’ï¼Œå¦‚ä¸‹æ‰€ç¤ºé…ç½®å€¼ä¸ºæ¯«ç§’æ—¶é—´æˆ³ã€‚
&amp;lt;tars&amp;gt; &amp;lt;application&amp;gt; &amp;lt;client&amp;gt; # é»˜è®¤å€¼ä¸º3000æ¯«ç§’ clientdialtimeout=3000 &amp;lt;/client&amp;gt; &amp;lt;/application&amp;gt; &amp;lt;/tars&amp;gt; æœåŠ¡è°ƒç”¨çš„è¶…æ—¶ å’Œä¸Šé¢è¿æ¥è¶…æ—¶çš„é…ç½®ç±»ä¼¼ã€‚ä¹Ÿå¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶è¿›è¡Œé…ç½®ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š
&amp;lt;tars&amp;gt; &amp;lt;application&amp;gt; &amp;lt;client&amp;gt; # é»˜è®¤å€¼ä¸º3000æ¯«ç§’ async-invoke-timeout=3000 &amp;lt;/client&amp;gt; &amp;lt;/application&amp;gt; &amp;lt;/tars&amp;gt; åŒæ—¶XXXWithContextæœåŠ¡è°ƒç”¨çš„ç¬¬ä¸€ä¸ªå‚æ•°å‡æ˜¯context.</description></item><item><title>å†™ç»™Goå¼€å‘è€…çš„Tarsæ•™ç¨‹-context/status</title><link>/2024/01/09/tarsgo-context/</link><pubDate>Tue, 09 Jan 2024 15:20:00 +0800</pubDate><author>lbbniu@gmail.com (lbbniu)</author><guid>/2024/01/09/tarsgo-context/</guid><description>æœ¬ç¯‡ä¸ºã€å†™ç»™goå¼€å‘è€…çš„Tarsæ•™ç¨‹ã€‘ç³»åˆ—ç¬¬äº”ç¯‡
ç¬¬ä¸€ç¯‡ï¼šTarsåè®®åŸºç¡€ ç¬¬äºŒç¯‡ï¼šé€šä¿¡æ¨¡å¼ ç¬¬ä¸‰ç¯‡ï¼šæ‹¦æˆªå™¨ ç¬¬å››ç¯‡ï¼šé”™è¯¯å¤„ç† ç¬¬äº”ç¯‡ï¼šcontext/status
æœ¬ç³»åˆ—å°†æŒç»­æ›´æ–°ï¼Œæ¬¢è¿å…³æ³¨ğŸ‘è·å–å®æ—¶é€šçŸ¥
å¯¼è¯­
å’Œåœ¨æ™®é€šHTTPè¯·æ±‚ä¸­ä¸€æ ·ï¼ŒTarsGoæä¾›äº†åœ¨æ¯ä¸€æ¬¡RPCä¸­æºå¸¦ä¸Šä¸‹æ–‡çš„ç»“æ„ï¼šcontextå’Œstatusã€‚åœ¨Goè¯­è¨€ä¸­ï¼Œå®ƒä¸context.Contextç´§å¯†ç»“åˆï¼Œå¸®åŠ©æˆ‘ä»¬å®ç°æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯ä¹‹é—´äº’ç›¸ä¼ é€’ä¿¡æ¯ã€‚å…¶ä¸­statusä¸»è¦ç”¨äºæ¡†æ¶åº•å±‚ä¼ é€’ä¸€äº›æ¡†æ¶ç‰¹æ€§ç›¸å…³çš„æ•°æ®ã€‚
ä»€ä¹ˆæ˜¯ contextï¼Ÿ TarsGo çš„ contextå’Œstatusçš„ç®€å•ç†è§£ï¼Œå°±æ˜¯ HTTP Header ä¸­çš„ key-value å¯¹
contextå’Œstatus éƒ½æ˜¯ä»¥ key-value çš„å½¢å¼å­˜å‚¨æ•°æ®çš„ï¼Œå…¶ä¸­ key å’Œ valueéƒ½æ˜¯ string ç±»å‹ã€‚ contextå’Œstatus ä½¿å¾— client å’Œ server èƒ½å¤Ÿä¸ºå¯¹æ–¹æä¾›å…³äºæœ¬æ¬¡è°ƒç”¨çš„ä¸€äº›ä¿¡æ¯ï¼Œå°±åƒä¸€æ¬¡HTTPè¯·æ±‚çš„Request Headerå’ŒResponse Headerä¸€æ · HTTP Header çš„ç”Ÿå‘½å‘¨æœŸæ˜¯ä¸€æ¬¡ HTTP è¯·æ±‚ï¼Œé‚£ä¹ˆ contextå’Œstatus çš„ç”Ÿå‘½å‘¨æœŸå°±æ˜¯ä¸€æ¬¡ RPC è°ƒç”¨ contextå’Œstatus åˆ›å»º ğŸŒ² ç›´æ¥ä½¿ç”¨makeå³å¯ï¼š context := make(map[string]string) status := make(map[string]string) ğŸŒ² ç›´æ¥ä½¿ç”¨mapåˆå§‹åŒ–æ–¹å¼ï¼š context := map[string]string{&amp;quot;key1&amp;quot;:&amp;quot;value1&amp;quot;,&amp;quot;key2&amp;quot;:&amp;quot;value2&amp;quot;} status := map[string]string{&amp;quot;key1&amp;quot;:&amp;quot;value1&amp;quot;,&amp;quot;key2&amp;quot;:&amp;quot;value2&amp;quot;} contextå’Œstatus å‘é€å’Œæ¥å— è®©æˆ‘ä»¬å†æ¬¡å›é¡¾ä¸‹tarsæ–‡ä»¶å’Œç”Ÿæˆå‡ºæ¥çš„clientä¸serverç«¯çš„æ¥å£
module order { struct Order { 1 require string id; 2 optional vector&amp;lt;string&amp;gt; items; 3 optional string description; 4 require float price; 5 optional string destination; }; interface OrderManagement { Order getOrder(string orderId); }; }; type OrderManagement struct { servant m.</description></item><item><title>å†™ç»™goå¼€å‘è€…çš„Tarsæ•™ç¨‹-é”™è¯¯å¤„ç†</title><link>/2024/01/08/tarsgo-errors/</link><pubDate>Mon, 08 Jan 2024 15:20:00 +0800</pubDate><author>lbbniu@gmail.com (lbbniu)</author><guid>/2024/01/08/tarsgo-errors/</guid><description>æœ¬ç¯‡ä¸ºã€å†™ç»™goå¼€å‘è€…çš„Tarsæ•™ç¨‹ã€‘ç³»åˆ—ç¬¬å››ç¯‡
ç¬¬ä¸€ç¯‡ï¼šTarsåè®®åŸºç¡€ ç¬¬äºŒç¯‡ï¼šé€šä¿¡æ¨¡å¼ ç¬¬ä¸‰ç¯‡ï¼šæ‹¦æˆªå™¨ ç¬¬å››ç¯‡ï¼šé”™è¯¯å¤„ç†
æœ¬ç³»åˆ—å°†æŒç»­æ›´æ–°ï¼Œæ¬¢è¿å…³æ³¨ğŸ‘è·å–å®æ—¶é€šçŸ¥
åŸºæœ¬é”™è¯¯å¤„ç† é¦–å…ˆå›é¡¾ä¸‹tarsæ–‡ä»¶å’Œç”Ÿæˆå‡ºæ¥çš„clientä¸serverç«¯çš„æ¥å£
module order { struct Order { 1 require string id; 2 optional vector&amp;lt;string&amp;gt; items; 3 optional string description; 4 require float price; 5 optional string destination; }; interface OrderManagement { Order getOrder(string orderId); }; }; type OrderManagement struct { servant m.Servant } func (obj *OrderManagement) GetOrder(orderId string, opts ...map[string]string) (Order, error) { return obj.GetOrderWithContext(context.Background(), orderId, opts...) } func (obj *OrderManagement) GetOrderWithContext(tarsCtx context.Context, orderId string, opts ...map[string]string) (ret Order, err error) { // .</description></item><item><title>å†™ç»™goå¼€å‘è€…çš„Tarsæ•™ç¨‹-æ‹¦æˆªå™¨</title><link>/2024/01/07/tarsgo-middleware/</link><pubDate>Sun, 07 Jan 2024 15:20:00 +0800</pubDate><author>lbbniu@gmail.com (lbbniu)</author><guid>/2024/01/07/tarsgo-middleware/</guid><description>æœ¬ç¯‡ä¸ºã€å†™ç»™goå¼€å‘è€…çš„Tarsæ•™ç¨‹ã€‘ç³»åˆ—ç¬¬ä¸‰ç¯‡
ç¬¬ä¸€ç¯‡ï¼šTarsåè®®åŸºç¡€ ç¬¬äºŒç¯‡ï¼šé€šä¿¡æ¨¡å¼ ç¬¬ä¸‰ç¯‡ï¼šæ‹¦æˆªå™¨
TarsGoçš„æ‹¦æˆªå™¨å’Œå…¶ä»–æ¡†æ¶çš„æ‹¦æˆªå™¨ï¼ˆä¹Ÿç§°middlewareï¼‰ä½œç”¨æ˜¯ä¸€æ ·çš„ã€‚åˆ©ç”¨æ‹¦æˆªå™¨æˆ‘ä»¬å¯ä»¥åœ¨ä¸ä¾µå…¥ä¸šåŠ¡é€»è¾‘çš„å‰æä¸‹ä¿®æ”¹æˆ–è€…è®°å½•æœåŠ¡ç«¯æˆ–å®¢æˆ·ç«¯çš„è¯·æ±‚ä¸å“åº”ï¼Œåˆ©ç”¨æ‹¦æˆªå™¨æˆ‘ä»¬å¯ä»¥å®ç°è¯¸å¦‚æ—¥å¿—è®°å½•ã€æƒé™è®¤è¯ã€é™æµã€é“¾è·¯è¿½è¸ªç­‰è¯¸å¤šåŠŸèƒ½ã€‚æ‹¦æˆªå™¨å¯ä»¥åˆ†åˆ«åº”ç”¨åœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ï¼Œæ‰€ä»¥TarsGoæ€»å…±ä¸ºæˆ‘ä»¬æä¾›äº†å¤šç§æ‹¦æˆªå™¨ï¼Œä¸‹é¢æˆ‘ä»¬è¿›è¡Œä¸€ä¸€ä»‹ç»ã€‚
æœåŠ¡ç«¯æ‹¦æˆªå™¨ï¼ˆè¿‡æ»¤å™¨ï¼‰ å¤„ç†å‰åæ‹¦æˆªå™¨ï¼ˆè¿‡æ»¤å™¨ï¼‰ æ‹¦æˆªå™¨å®šä¹‰å¦‚ä¸‹ï¼š
// Dispatch server side Dispatch type Dispatch func(context.Context, interface{}, *requestf.RequestPacket, *requestf.ResponsePacket, bool) error // ServerFilter is used for add Filter for server dispatcher ,for implementing plugins like opentracing. type ServerFilter func(ctx context.Context, d Dispatch, f interface{}, req *requestf.RequestPacket, resp *requestf.ResponsePacket, withContext bool) (err error) æ³¨å†ŒæœåŠ¡ç«¯æ‹¦æˆªå™¨çš„æ–¹æ³•å¦‚ä¸‹ï¼š
func RegisterServerFilter(f ServerFilter) // æ³¨å†ŒæœåŠ¡ç«¯æ‹¦æˆªå™¨ï¼Œåªèƒ½æ³¨å†Œä¸€ä¸ª func RegisterPreServerFilter(f ServerFilter) // æ³¨å†ŒæœåŠ¡ç«¯å¤„ç†å‰æ‹¦æˆªå™¨ï¼Œå¯å¤šä¸ª func RegisterPostServerFilter(f ServerFilter) // æ³¨å†ŒæœåŠ¡ç«¯å¤„ç†åæ‹¦æˆªå™¨ï¼Œå¯å¤šä¸ª ä¸æ¨èä¸Šé¢ä¸‰ç§æ³¨å†Œæ–¹æ³•æ¥æ³¨å†Œæ‹¦æˆªä»¶ï¼Œå°†åœ¨1.5ç‰ˆæœ¬åå½»åº•åºŸå¼ƒç§»é™¤ï¼Œæ¨èä½¿ç”¨ä¸‹é¢ä»‹ç»çš„ä¸­é—´ä»¶å®ç°å¯¹åº”çš„é€»è¾‘ã€‚
ç¤ºä¾‹ï¼š
// æ³¨å†ŒæœåŠ¡ç«¯è¿‡æ»¤å™¨ tars.RegisterServerFilter(func(ctx context.Context, d tars.</description></item></channel></rss>