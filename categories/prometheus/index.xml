<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Prometheus on lbbniu</title><link>/categories/prometheus/</link><description>Recent content in Prometheus on lbbniu</description><generator>Hugo -- gohugo.io</generator><language>zh</language><managingEditor>lbbniu@gmail.com (lbbniu)</managingEditor><webMaster>lbbniu@gmail.com (lbbniu)</webMaster><copyright>&amp;copy; 2021 &lt;a href="https://blog.lbbniu.com/">lbbniu&lt;/a></copyright><lastBuildDate>Tue, 06 Feb 2024 23:43:47 +0800</lastBuildDate><atom:link href="/categories/prometheus/index.xml" rel="self" type="application/rss+xml"/><item><title>pushgateway group清理</title><link>/2022/02/15/pushgateway-group%E6%B8%85%E7%90%86/</link><pubDate>Tue, 15 Feb 2022 15:20:00 +0800</pubDate><author>lbbniu@gmail.com (lbbniu)</author><guid>/2022/02/15/pushgateway-group%E6%B8%85%E7%90%86/</guid><description>trap 'echo &amp;quot;got sigterm&amp;quot; ; exit 0' SIGTERM EXPIRATION_SECONDS=${EXPIRATION_SECONDS:-600} PGW_URL=${PGW_URL:-http://10.176.78.78:9091} function convert_to_standardnotation(){ # convert number from scientific notation to standar d( ie '1.5383780136826127e+09' ) printf '%.0f' $1 } function extract_pushgateway_variable(){ local -r _METRIC=$1 local -r _VARNAME=$2 #echo 'push_time_seconds{instance=&amp;quot;10.32.32.7&amp;quot;,job=&amp;quot;bk_jenkins&amp;quot;} 1.5383802210997093e+09' | sed -r 's/.*instance=&amp;quot;([^&amp;quot;]*).*/\1/g' echo $_METRIC | sed -r &amp;quot;s/.*${_VARNAME}=\&amp;quot;([^\&amp;quot;]*).*/\\1/g&amp;quot; # sample usage : # extract_pushgateway_variable 'push_time_seconds{instance=&amp;quot;10.32.32.7&amp;quot;,job=&amp;quot;bk_jenkins&amp;quot;} 1.5383802210997093e+09' 'instance' } function extract_pushgateway_uri(){ local -r _METRIC=$1 #echo 'push_time_seconds{instance=&amp;quot;10.32.32.7&amp;quot;,job=&amp;quot;bk_jenkins&amp;quot;} 1.5383802210997093e+09' | awk -F{ '{print $2}' | awk -F} '{print $1}' | sed -e &amp;quot;s/[=,]/\//g&amp;quot; -e &amp;quot;s/\&amp;quot;//g&amp;quot; metricJob=$(extract_pushgateway_variable &amp;quot;$_METRIC&amp;quot; 'job') echo $_METRIC | awk -F{ '{print $2}' | awk -F} '{print $1}' | sed -e &amp;quot;s/[=,]/\//g&amp;quot; -e &amp;quot;s/\&amp;quot;//g&amp;quot; -e &amp;quot;s/job\///g&amp;quot; -e &amp;quot;s/${metricJob}\///g&amp;quot; -e &amp;quot;s/instance\/\///g&amp;quot; # sample usage : # extract_pushgateway_uri 'push_time_seconds{instance=&amp;quot;10.</description></item></channel></rss>